@model IEnumerable<KlipboardAssessment.Models.Customer>


<div class="container text-center">
    <h1>Welcome, Admin.</h1>

    <div class="col">
        <a class="btn btn-primary text-center"
           asp-controller="Customer"
           asp-action="AddCustomer">
            Add Customers
        </a>
    </div>

    <div style="margin: 1rem 0;">
        <form asp-action="Index" method="get">
            <div class="input-group mb-3">
                <input type="text" name="searchQuery" class="form-control" placeholder="Search by name..." value="@ViewBag.SearchQuery" />
                <button class="btn btn-outline-secondary" type="submit">Search</button>
            </div>

            <div class="form-group d-flex justify-content-center gap-3">
                <div>
                    <label for="sortField">Sort By:</label>
                    <select name="sortField" id="sortField" class="form-control" onchange="this.form.submit()">
                        <option value="AccountNumber" selected="@(ViewBag.SortField == "AccountNumber")">Account Number</option>
                        <option value="Name" selected="@(ViewBag.SortField == "Name")">Customer Name</option>
                        <option value="Balance" selected="@(ViewBag.SortField == "Balance")">Balance</option>
                    </select>
                </div>
                <div>
                    <label for="sortOrder">Order:</label>
                    <select name="sortOrder" id="sortOrder" class="form-control" onchange="this.form.submit()">
                        <option value="Asc" selected="@(ViewBag.SortOrder == "Asc")">Ascending</option>
                        <option value="Desc" selected="@(ViewBag.SortOrder == "Desc")">Descending</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
   
    <table class="table">
        <tr>
			<th>Customer Account Number</th>
            <th>Customer Name</th>
			<th>Customer Balance</th>
            <th>Transactions</th>
            <th>Actions</th>
        </tr>
        @foreach (var customer in Model)
        {
            <tr>
				<td>@customer.AccountNumber</td>
				<td>@customer.Name</td>
                <td>@customer.Balance</td>
                <td>
                    @* Transactions *@
                    <a class="btn btn-info" asp-action="Index" asp-route-id="@customer.Id" asp-controller="Transactions">Transactions</a>
                </td>
                <td>
                    @* GET REQUEST *@
                    <a class="btn btn-primary"
                       asp-controller="Customer"
                       asp-action="Edit"
                       asp-route-id="@customer.Id"
                       id="editBtn"
                       >
                        Edit
                    </a>
                    @* POST REQUEST *@
                    <form asp-controller="Customer" asp-action="Delete" asp-route-id="@customer.Id" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger" id="deleteBtn_@customer.Id">
                            Delete
                        </button>
                    </form>
                </td>
                
            </tr>
        }
    </table>
</div>

<script>
	const deleteBtns = document.querySelectorAll("button[id^='deleteBtn_']");

	deleteBtns.forEach(btn => btn.addEventListener("click", function(event) {
		  if (!confirm("Are you sure you want to delete this customer?")) {
			  event.preventDefault();
		  }
	  }));
</script>
